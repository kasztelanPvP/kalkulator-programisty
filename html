<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kalkulator Programistyczny</title>
    <style>
        :root {
            --bg-color: #121212;
            --surface: #1e1e1e;
            --primary: #bb86fc;
            --text: #ffffff;
            --text-dim: #a0a0a0;
            --btn-bg: #2c2c2c;
            --btn-active: #3c3c3c;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        /* Ekrany wyświetlaczy */
        .displays {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            gap: 15px;
        }
        .display-row {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .display-row.active {
            background-color: rgba(187, 134, 252, 0.15);
            border-left: 4px solid var(--primary);
        }
        .label {
            width: 40px;
            font-weight: bold;
            color: var(--text-dim);
            font-size: 14px;
        }
        .display-row.active .label {
            color: var(--primary);
        }
        .value {
            flex: 1;
            text-align: right;
            font-size: 24px;
            font-family: monospace;
            word-break: break-all;
        }
        
        /* Klawiatura */
        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: #000;
            padding-bottom: env(safe-area-inset-bottom);
        }
        button {
            background-color: var(--surface);
            color: var(--text);
            border: none;
            padding: 20px 0;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.1s;
        }
        button:active {
            background-color: var(--btn-active);
        }
        button:disabled {
            color: #444;
            background-color: var(--bg-color);
        }
        .action-btn { color: #ff5252; }
    </style>
</head>
<body>

    <div class="displays">
        <div class="display-row" id="row-16" onclick="setBase(16)">
            <div class="label">HEX</div>
            <div class="value" id="val-16">0</div>
        </div>
        <div class="display-row active" id="row-10" onclick="setBase(10)">
            <div class="label">DEC</div>
            <div class="value" id="val-10">0</div>
        </div>
        <div class="display-row" id="row-2" onclick="setBase(2)">
            <div class="label">BIN</div>
            <div class="value" id="val-2">0</div>
        </div>
    </div>

    <div class="keypad">
        <button onclick="input('A')" class="hex-key">A</button>
        <button onclick="input('B')" class="hex-key">B</button>
        <button onclick="clearAll()" class="action-btn">AC</button>
        <button onclick="backspace()" class="action-btn">DEL</button>

        <button onclick="input('C')" class="hex-key">C</button>
        <button onclick="input('D')" class="hex-key">D</button>
        <button onclick="input('7')" class="dec-key">7</button>
        <button onclick="input('8')" class="dec-key">8</button>
        
        <button onclick="input('E')" class="hex-key">E</button>
        <button onclick="input('F')" class="hex-key">F</button>
        <button onclick="input('4')" class="dec-key">4</button>
        <button onclick="input('5')" class="dec-key">5</button>

        <button onclick="input('9')" class="dec-key">9</button>
        <button onclick="input('6')" class="dec-key">6</button>
        <button onclick="input('1')" class="bin-key">1</button>
        <button onclick="input('2')" class="dec-key">2</button>

        <button onclick="input('3')" class="dec-key">3</button>
        <button onclick="input('0')" class="bin-key" style="grid-column: span 3;">0</button>
    </div>

    <script>
        let currentBase = 10;
        let currentValue = "0";

        function setBase(base) {
            currentBase = base;
            
            // Aktualizacja UI (zaznaczenie aktywnego wiersza)
            document.querySelectorAll('.display-row').forEach(row => row.classList.remove('active'));
            document.getElementById(`row-${base}`).classList.add('active');
            
            // Pobranie aktualnej wartości w nowej bazie
            currentValue = document.getElementById(`val-${base}`).innerText;
            if(currentValue === "0") currentValue = "";

            updateKeys();
        }

        function updateKeys() {
            const hexKeys = document.querySelectorAll('.hex-key');
            const decKeys = document.querySelectorAll('.dec-key');
            
            // Wyłącz/włącz klawisze w zależności od bazy
            hexKeys.forEach(k => k.disabled = (currentBase < 16));
            decKeys.forEach(k => k.disabled = (currentBase < 10));
        }

        function input(char) {
            if (currentValue === "0") currentValue = "";
            currentValue += char;
            updateDisplays();
        }

        function clearAll() {
            currentValue = "0";
            updateDisplays();
        }

        function backspace() {
            if (currentValue.length > 1) {
                currentValue = currentValue.slice(0, -1);
            } else {
                currentValue = "0";
            }
            updateDisplays();
        }

        function updateDisplays() {
            if (currentValue === "") currentValue = "0";
            
            try {
                // Używamy BigInt, aby uniknąć problemów z precyzją przy dużych liczbach
                let decimalValue = BigInt("0");
                
                if (currentBase === 10) {
                    decimalValue = BigInt(currentValue);
                } else if (currentBase === 16) {
                    decimalValue = BigInt("0x" + currentValue);
                } else if (currentBase === 2) {
                    decimalValue = BigInt("0b" + currentValue);
                }

                // Aktualizacja tekstów na ekranie
                document.getElementById('val-16').innerText = decimalValue.toString(16).toUpperCase();
                document.getElementById('val-10').innerText = decimalValue.toString(10);
                document.getElementById('val-2').innerText = decimalValue.toString(2);
            } catch (e) {
                // Zapobieganie błędom przy niepoprawnym parsowaniu
            }
        }

        // Inicjalizacja stanu klawiszy na starcie
        updateKeys();
    </script>
</body>
</html>
